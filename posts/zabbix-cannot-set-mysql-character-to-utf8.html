<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <title>记一次 zabbix 数据库编码排错 - Cynosura</title>
    <meta name="description" content="简单记录在 zabbix 5.0 上遇到数据库乱码的解决过程">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Pelican">
    <!--主题色-->
    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#EBF4F4">
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#121212">
    <!--Open Graph protocol-->
    <meta property="og:type" content="article">
    <meta property="og:title" content="记一次 zabbix 数据库编码排错 - Cynosura">
    <meta property="og:description" content="简单记录在 zabbix 5.0 上遇到数据库乱码的解决过程">
    <meta property="og:url" content="https://cynosura.one/posts/zabbix-cannot-set-mysql-character-to-utf8.html">
    <meta property="og:image" content="https://cynosura.one/img/banner.webp">
    <!--Twitter Card-->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@astraorsa">
    <meta name="twitter:title" content="记一次 zabbix 数据库编码排错 - Cynosura">
    <meta name="twitter:description" content="简单记录在 zabbix 5.0 上遇到数据库乱码的解决过程">
    <meta name="twitter:image" content="https://cynosura.one/img/banner.webp">
    <!--链接样式-->
    <link rel="stylesheet" type="text/css" href="https://cynosura.one/css/style.css?v=2.3.2">
    <link rel="icon" type="image/x-icon" href="https://cynosura.one/img/favicon.ico">
    <!--加载字体-->
    <link rel="preload" href="https://cynosura.one/font/Overpass-Regular.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="https://cynosura.one/font/Overpass-Bold.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="https://cynosura.one/font/OverpassMono-Regular.woff2" as="font" type="font/woff2" crossorigin>
    <!--Sitemap-->
    <link rel="sitemap" type="application/xml" title="Sitemap" href="https://cynosura.one/posts/sitemap.xml">
    <!--Feed RSS-->
    <link rel="alternate" type="application/atom+xml" title="Cynosura Full Atom Feed" href="https://cynosura.one/posts/feeds/all.atom.xml">
</head>
<body>
    <header>
        <img class="header-avatar" src="https://cynosura.one/img/avatar.webp" alt="site-avatar">
        <h1 class="header-title">Cynosura</h1>
        <p class="header-description">Trying to light up the dark.</p>
        <nav class="old-menu" style="display: none;">
            <ul>
                <li><a href="https://cynosura.one" class="menu-link">首页</a></li>
                <li><a href="https://cynosura.one/posts" class="menu-link-active">文章</a></li>
                <li><a href="https://cynosura.one/friends" class="menu-link">友人</a></li>
                <li><a href="https://cynosura.one/about" class="menu-link">关于</a></li>
            </ul>
        </nav>
    </header>
<main class="post-article-main">
    <nav class="menu">
        <div class="menu-a">
            <button class="menu-button" onclick="window.location.href='https://cynosura.one'">
                <svg class="icon menu-icon" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M17.8913288,10 L11.8900003,3.99867157 L5.88867192,10 L5.89001465,10 L5.89001465,20 L17.8900146,20 L17.8900146,10 L17.8913288,10 Z M19.8900146,11.9986859 L19.8900146,20 C19.8900146,21.1045695 18.9945841,22 17.8900146,22 L5.89001465,22 C4.78544515,22 3.89001465,21.1045695 3.89001465,20 L3.89001465,11.9986573 L2.41319817,13.4754737 L1,12.0622756 L10.4769858,2.5852898 C11.2573722,1.8049034 12.5226285,1.8049034 13.3030149,2.5852898 L22.7800007,12.0622756 L21.3668025,13.4754737 L19.8900146,11.9986859 Z" fill-rule="evenodd"/></svg>
                <span class="menu-button-text">首页</span>
            </button>
            <button class="menu-button-active menu-button" onclick="window.location.href='https://cynosura.one/posts'">
                <svg class="icon menu-icon" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M12.3023235,7.94519388 L4.69610276,15.549589 C4.29095108,15.9079238 4.04030835,16.4092335 4,16.8678295 L4,20.0029438 L7.06398288,20.004826 C7.5982069,19.9670062 8.09548693,19.7183782 8.49479322,19.2616227 L16.0567001,11.6997158 L12.3023235,7.94519388 Z M13.7167068,6.53115006 L17.4709137,10.2855022 L19.8647941,7.89162181 C19.9513987,7.80501747 20.0000526,7.68755666 20.0000526,7.56507948 C20.0000526,7.4426023 19.9513987,7.32514149 19.8647932,7.23853626 L16.7611243,4.13485646 C16.6754884,4.04854589 16.5589355,4 16.43735,4 C16.3157645,4 16.1992116,4.04854589 16.1135757,4.13485646 L13.7167068,6.53115006 Z M16.43735,2 C17.0920882,2 17.7197259,2.26141978 18.1781068,2.7234227 L21.2790059,5.82432181 C21.7406843,6.28599904 22.0000526,6.91216845 22.0000526,7.56507948 C22.0000526,8.21799052 21.7406843,8.84415992 21.2790068,9.30583626 L9.95750718,20.6237545 C9.25902448,21.4294925 8.26890003,21.9245308 7.1346,22.0023295 L2,22.0023295 L2,21.0023295 L2.00324765,16.7873015 C2.08843822,15.7328366 2.57866679,14.7523321 3.32649633,14.0934196 L14.6953877,2.72462818 C15.1563921,2.2608295 15.7833514,2 16.43735,2 Z" fill-rule="evenodd"/></svg>
                <span class="menu-button-text-active">文章</span>
            </button>
            <button class="menu-button" onclick="window.location.href='https://cynosura.one/friends'">
                <svg class="icon menu-icon" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M16.4341517,5.34027649 C19.5526401,4.82550436 21.9775728,5.30066885 22.7613144,6.98140814 C23.5450164,8.66206251 22.3504571,10.824965 19.951836,12.8828831 C19.5123956,16.8857302 16.1198862,20 12,20 C10.359675,20 8.83465517,19.5063199 7.56541555,18.6594348 C4.44608523,19.1746732 2.02039254,18.6996452 1.23650448,17.0185919 C0.452540248,15.3373751 1.64816139,13.1735876 4.04839101,11.1150512 C4.48877158,7.11319839 7.88082257,4 12,4 C13.6401386,4 15.1649982,4.49356789 16.4341517,5.34027649 Z M18.3526801,7.13687265 C19.0478987,8.04366602 19.553342,9.10361155 19.8096504,10.2573495 C20.759634,9.23569807 21.1931253,8.35081879 20.9486988,7.82664467 C20.7041658,7.30224176 19.7469377,7.06554811 18.3526801,7.13687265 Z M5.64723739,16.8630198 C4.95168113,15.9557542 4.44609504,14.8951833 4.1899293,13.7407574 C3.23872065,14.7632088 2.80454268,15.6488575 3.04912005,16.1733553 C3.29377581,16.6980213 4.25184178,16.9346893 5.64723739,16.8630198 Z M17.998801,11.8788388 C17.9342721,8.62105818 15.2732265,6 12,6 C8.6862915,6 6,8.6862915 6,12 C6,13.8017545 6.79417414,15.4180196 8.05156374,16.5178367 C9.61918795,16.1740501 11.4219878,15.5791568 13.2667642,14.7189234 C15.1123744,13.8583012 16.727532,12.8591526 17.998801,11.8788388 Z M17.3040733,14.8073455 C16.3274273,15.4175193 15.2552552,15.9984306 14.1120008,16.5315389 C12.9695057,17.0642931 11.8360704,17.5119809 10.7415499,17.8678087 C11.1473536,17.9544194 11.5683538,18 12,18 C14.2994717,18 16.2968203,16.7064576 17.3040733,14.8073455 Z" fill-rule="evenodd"/></svg>
                <span class="menu-button-text-active">友人</span>
            </button>
            <button class="menu-button" onclick="window.location.href='https://cynosura.one/about'">
                <svg class="icon menu-icon" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M12,23 C5.92486775,23 1,18.0751322 1,12 C1,5.92486775 5.92486775,1 12,1 C18.0751322,1 23,5.92486775 23,12 C23,18.0751322 18.0751322,23 12,23 Z M12,21 C16.9705627,21 21,16.9705627 21,12 C21,7.02943725 16.9705627,3 12,3 C7.02943725,3 3,7.02943725 3,12 C3,16.9705627 7.02943725,21 12,21 Z M13.0036109,13.9983464 L14.0029544,13.9983464 L14.0029544,15.9983464 L10.0029544,15.9983464 L10.0029544,13.9983464 L11.0029544,13.9983464 L11.0029544,11.9983464 L10.0029544,11.9983464 L10.0029544,9.99834639 L13.0036109,9.99834639 L13.0036109,13.9983464 Z M12.0003283,8.99834639 C11.4478622,8.99834639 11,8.55063114 11,7.99834639 C11,7.44606164 11.4478622,6.99834639 12.0003283,6.99834639 C12.5527943,6.99834639 13.0006565,7.44606164 13.0006565,7.99834639 C13.0006565,8.55063114 12.5527943,8.99834639 12.0003283,8.99834639 Z" fill-rule="evenodd"/></svg>
                <span class="menu-button-text">关于</span>
            </button>
        </div>
        <div class="menu-b">
            <button class="menu-button" id="open-menu">
                <svg class="icon menu-icon" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><line x1="3" x2="21" y1="12" y2="12"/><line x1="3" x2="21" y1="6" y2="6"/><line x1="3" x2="21" y1="18" y2="18"/></svg>
            </button>
        </div>
    </nav>
    <div class="menu-b-drawer-container" id="drawer">
        <div class="menu-b-drawer-content">
            <img class="menu-b-personal-avatar" src="https://cynosura.one/img/profile-avatar.webp" alt="personal-avatar">
            <h2 class="subtitle">赤茶</h2>
            <p class="menu-b-description">Per aspera, ad astra.</p>
            <hr>
            <h3 class="subtitle">订阅文章</h3>
            <button class="menu-b-button post-button" onclick="window.location.href='https://cynosura.one/posts/feeds/all.atom.xml'" type="button" id="post-rss" title="RSS Feed">
                <svg class="post-icon" height="100%" viewBox="0 0 48 48" width="100%" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h48v48H0z" fill="none"/><circle cx="12.36" cy="35.64" r="4.36"/><path d="M8 8.89v5.66c14.06 0 25.46 11.4 25.46 25.46h5.66C39.11 22.82 25.18 8.89 8 8.89zM8 20.2v5.66c7.81 0 14.14 6.34 14.14 14.14h5.66c0-10.93-8.87-19.8-19.8-19.8z"/></svg>
            </button>
            <h3 class="subtitle">文章分类</h3>
            <div class="post-left-menu-categories">
                <a class="menu-b-button" href="https://cynosura.one/posts/category/ji-zhu.html"><span class="menu-b-button post-left-menu-category">技术</span></a>
                <a class="menu-b-button" href="https://cynosura.one/posts/category/ri-chang.html"><span class="menu-b-button post-left-menu-category">日常</span></a>
                <a class="menu-b-button" href="https://cynosura.one/posts/category/za-tan.html"><span class="menu-b-button post-left-menu-category">杂谈</span></a>
            </div>
            <div class="menu-b-close-div">
                <button class="menu-button" id="close-menu">
                    <svg class="icon menu-icon" height="24" version="1.1" viewBox="0 0 512 512" width="24" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M437.5,386.6L306.9,256l130.6-130.6c14.1-14.1,14.1-36.8,0-50.9c-14.1-14.1-36.8-14.1-50.9,0L256,205.1L125.4,74.5  c-14.1-14.1-36.8-14.1-50.9,0c-14.1,14.1-14.1,36.8,0,50.9L205.1,256L74.5,386.6c-14.1,14.1-14.1,36.8,0,50.9  c14.1,14.1,36.8,14.1,50.9,0L256,306.9l130.6,130.6c14.1,14.1,36.8,14.1,50.9,0C451.5,423.4,451.5,400.6,437.5,386.6z"/></svg>
                </button>
            </div>
        </div>
    </div>
    <article class="post-article card">
        <div>
            <h1 class="post-article-title">记一次 zabbix 数据库编码排错</h1>
            
        </div>
        <div class="post-article-content">
            <p>这几天在折腾 zabbix 5.x 上奇怪的编码问题，原型规则写的是中文，页面上也正常显示了中文，但 Discover 到具体监控项，以及告警推送就全部变 "???" 了。</p>
<p>查日志报错 cannot set MySQL character set to "utf8"，如图：</p>
<p><img alt="issue-1" src="images/zabbix-cannot-set-mysql-character-to-utf8/issue-1.png"></p>
<p>搜了一圈推测是 zabbix 和 MariaDB 的兼容问题，MariaDB 10.6 不支持直接 'utf8'，只支持具体到 'utf8mb3' 或 'utf8mb4'，而 zabbix 的检测逻辑没考虑到数据库不支持 'utf8' 的情况，而官方问题追踪里说已经在 zabbix 5.0.26 里 <a href="https://support.zabbix.com/browse/ZBX-21301">修了</a>。</p>
<p><img alt="issue-2" src="images/zabbix-cannot-set-mysql-character-to-utf8/issue-2.jpg"></p>
<p>在 zabbix 推出 5.0.26 正式版本之前，建议改用其他数据库，或使用 zabbix 6.x 版本并改用 'utf8mb4' 编码。</p>
        </div>
    </article>
    <div class="post-article-footer">
        <div class="post-article-meta card">
            <h2 class="card-title">本文信息</h2>
                <p><strong>作者: </strong>Frudrax Cheng</p>
            <p><strong>发布时间:</strong>
                <time class="published" datetime="2022-07-22T14:36:10+08:00">
                2022-07-22 (周五)
                </time>
            </p>
            <p><strong>文章分类: </strong>技术</p>
            <p><strong>链接: </strong><a href="https://cynosura.one/posts/zabbix-cannot-set-mysql-character-to-utf8.html" title="记一次 zabbix 数据库编码排错" class="p-link">https://cynosura.one/posts/zabbix-cannot-set-mysql-character-to-utf8.html</a></p>
        </div>
        <div class="post-article-copyright card">
            <h2 class="card-title">版权许可</h2>
            <p><strong>声明: </strong>本文所有内容（包括图片）</p>
            <p>均采用 <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0" target="_blank" title="Creative Commons Attribution-ShareAlike 4.0 International License">CC BY-SA 4.0</a> 协议授权</p>
            <p>转载请注明出处，并附上本声明内容</p>
            <img class="post-article-copyright-icon" src="https://cynosura.one/img/icons/creative-icon.svg" alt="creative-icon">
            <img class="post-article-copyright-icon" src="https://cynosura.one/img/icons/creative-icon-by.svg" alt="creative-icon-by">
            <img class="post-article-copyright-icon" src="https://cynosura.one/img/icons/creative-icon-sa.svg" alt="creative-icon-sa">
        </div>
    </div>
    <div class="post-article-comments card">
        <h2 class="card-title">评论</h2>
        <p>注: 留言系统基于 <a href="https://disqus.com">Disqus</a>，部分网络环境可能无法正常加载。</p>
        <div id="disqus_thread"></div>
        <!-- 添加一个按钮 -->
        <button id="load_disqus" class="comments-button button">加载评论</button>
        <!-- Disqus 留言板容器 -->
        <div id="disqus_thread_container"></div>
    </div>
    <script>
        // 点击按钮后加载 Disqus 留言板
        document.getElementById('load_disqus').addEventListener('click', function() {
            // 添加 Disqus 留言板脚本
            var disqusScript = document.createElement('script');
            disqusScript.src = 'https://cynosura-one.disqus.com/embed.js';
            disqusScript.setAttribute('data-timestamp', +new Date());
            document.head.appendChild(disqusScript);
            // 移动 Disqus 留言板内容到容器中
            var disqusContainer = document.getElementById('disqus_thread_container');
            disqusContainer.appendChild(document.getElementById('disqus_thread'));
            // 隐藏按钮，防止重复加载
            this.style.display = 'none';
        });
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <footer>
        <p>Designed by <a href="https://cynosura.one">Cynosura</a> &copy 2023</p>
        <script src="https://cynosura.one/js/menu.js?v=2.3.2" defer></script>
    </footer>
</body>
</html>